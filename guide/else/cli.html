<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>搭建一个脚手架工具 | Jiuto&#39;s blog</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="favicon.ico">
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/jiuto_blog/assets/css/0.styles.8eccc1ce.css" as="style"><link rel="preload" href="/jiuto_blog/assets/js/app.16126c5f.js" as="script"><link rel="preload" href="/jiuto_blog/assets/js/2.36a0744b.js" as="script"><link rel="preload" href="/jiuto_blog/assets/js/18.d246f955.js" as="script"><link rel="prefetch" href="/jiuto_blog/assets/js/10.6ff7a89c.js"><link rel="prefetch" href="/jiuto_blog/assets/js/11.c64eaba9.js"><link rel="prefetch" href="/jiuto_blog/assets/js/12.e7142276.js"><link rel="prefetch" href="/jiuto_blog/assets/js/13.8d1c025d.js"><link rel="prefetch" href="/jiuto_blog/assets/js/14.a93d2039.js"><link rel="prefetch" href="/jiuto_blog/assets/js/15.d92478a2.js"><link rel="prefetch" href="/jiuto_blog/assets/js/16.9feab1a1.js"><link rel="prefetch" href="/jiuto_blog/assets/js/17.e384a1a4.js"><link rel="prefetch" href="/jiuto_blog/assets/js/19.3e93a9b7.js"><link rel="prefetch" href="/jiuto_blog/assets/js/20.1f11bda6.js"><link rel="prefetch" href="/jiuto_blog/assets/js/21.bdbbbf48.js"><link rel="prefetch" href="/jiuto_blog/assets/js/22.3c38181c.js"><link rel="prefetch" href="/jiuto_blog/assets/js/23.9dbb2ee7.js"><link rel="prefetch" href="/jiuto_blog/assets/js/24.c73764c3.js"><link rel="prefetch" href="/jiuto_blog/assets/js/25.54e78843.js"><link rel="prefetch" href="/jiuto_blog/assets/js/26.4ce94a4c.js"><link rel="prefetch" href="/jiuto_blog/assets/js/27.f9c8e4cc.js"><link rel="prefetch" href="/jiuto_blog/assets/js/28.ed31d52a.js"><link rel="prefetch" href="/jiuto_blog/assets/js/29.68a36c1a.js"><link rel="prefetch" href="/jiuto_blog/assets/js/3.c426a4d7.js"><link rel="prefetch" href="/jiuto_blog/assets/js/30.a2fde92f.js"><link rel="prefetch" href="/jiuto_blog/assets/js/31.3b671c3b.js"><link rel="prefetch" href="/jiuto_blog/assets/js/32.fb35183b.js"><link rel="prefetch" href="/jiuto_blog/assets/js/33.fda23cf0.js"><link rel="prefetch" href="/jiuto_blog/assets/js/34.6738dc58.js"><link rel="prefetch" href="/jiuto_blog/assets/js/35.3dfe0dd1.js"><link rel="prefetch" href="/jiuto_blog/assets/js/36.5d2a8202.js"><link rel="prefetch" href="/jiuto_blog/assets/js/37.6b764801.js"><link rel="prefetch" href="/jiuto_blog/assets/js/38.55e19e91.js"><link rel="prefetch" href="/jiuto_blog/assets/js/39.01ee8242.js"><link rel="prefetch" href="/jiuto_blog/assets/js/4.865692a8.js"><link rel="prefetch" href="/jiuto_blog/assets/js/40.3fd4939d.js"><link rel="prefetch" href="/jiuto_blog/assets/js/41.efe97bec.js"><link rel="prefetch" href="/jiuto_blog/assets/js/42.43a3d8b5.js"><link rel="prefetch" href="/jiuto_blog/assets/js/43.b10404be.js"><link rel="prefetch" href="/jiuto_blog/assets/js/44.85c7b2da.js"><link rel="prefetch" href="/jiuto_blog/assets/js/45.cd318d2e.js"><link rel="prefetch" href="/jiuto_blog/assets/js/46.1c3aac9b.js"><link rel="prefetch" href="/jiuto_blog/assets/js/47.692c86fc.js"><link rel="prefetch" href="/jiuto_blog/assets/js/48.7524d1f0.js"><link rel="prefetch" href="/jiuto_blog/assets/js/49.23ad81dc.js"><link rel="prefetch" href="/jiuto_blog/assets/js/5.06b13832.js"><link rel="prefetch" href="/jiuto_blog/assets/js/50.516a9a6c.js"><link rel="prefetch" href="/jiuto_blog/assets/js/51.922c36a7.js"><link rel="prefetch" href="/jiuto_blog/assets/js/52.8ac6a07c.js"><link rel="prefetch" href="/jiuto_blog/assets/js/53.d742f304.js"><link rel="prefetch" href="/jiuto_blog/assets/js/54.2e9dc1a0.js"><link rel="prefetch" href="/jiuto_blog/assets/js/55.00f80b8a.js"><link rel="prefetch" href="/jiuto_blog/assets/js/6.c8b7a84a.js"><link rel="prefetch" href="/jiuto_blog/assets/js/7.2707fcd4.js"><link rel="prefetch" href="/jiuto_blog/assets/js/8.aeb8afae.js"><link rel="prefetch" href="/jiuto_blog/assets/js/9.652771f0.js">
    <link rel="stylesheet" href="/jiuto_blog/assets/css/0.styles.8eccc1ce.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/jiuto_blog/" class="home-link router-link-active"><!----> <span class="site-name">Jiuto's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/Jiuto" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/Jiuto" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JavaScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/jiuto_blog/guide/js/eventBus.html" class="sidebar-link">用Map写一个EventBus事件总线</a></li><li><a href="/jiuto_blog/guide/js/promise.html" class="sidebar-link">手写一个Promise</a></li><li><a href="/jiuto_blog/guide/js/babble_capture.html" class="sidebar-link">冒泡与捕获</a></li><li><a href="/jiuto_blog/guide/js/debounce_throttle.html" class="sidebar-link">防抖与节流</a></li><li><a href="/jiuto_blog/guide/js/clone.html" class="sidebar-link">浅拷贝和深拷贝</a></li><li><a href="/jiuto_blog/guide/js/module.html" class="sidebar-link">ES6 Module</a></li><li><a href="/jiuto_blog/guide/js/template.html" class="sidebar-link">模板引擎原理</a></li><li><a href="/jiuto_blog/guide/js/closure.html" class="sidebar-link">理解js闭包</a></li><li><a href="/jiuto_blog/guide/js/proto.html" class="sidebar-link">理解js原型、原型链和继承</a></li><li><a href="/jiuto_blog/guide/js/new.html" class="sidebar-link">手写 new 操作符</a></li><li><a href="/jiuto_blog/guide/js/bind.html" class="sidebar-link">手写 bind</a></li><li><a href="/jiuto_blog/guide/js/apply_call.html" class="sidebar-link">手写 apply 和 call</a></li><li><a href="/jiuto_blog/guide/js/let_const.html" class="sidebar-link">let、const和块级作用域</a></li><li><a href="/jiuto_blog/guide/js/curry.html" class="sidebar-link">柯里化</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>CSS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/jiuto_blog/guide/css/flex.html" class="sidebar-link">flex布局</a></li><li><a href="/jiuto_blog/guide/css/layout.html" class="sidebar-link">常见布局</a></li><li><a href="/jiuto_blog/guide/css/bfc.html" class="sidebar-link">BFC 块格式化上下文</a></li><li><a href="/jiuto_blog/guide/css/stacking_context.html" class="sidebar-link">层叠上下文、层叠层级、层叠顺序</a></li><li><a href="/jiuto_blog/guide/css/center.html" class="sidebar-link">水平居中、垂直居中</a></li><li><a href="/jiuto_blog/guide/css/grid.html" class="sidebar-link">grid 网格布局</a></li><li><a href="/jiuto_blog/guide/css/css3.html" class="sidebar-link">CSS3 动画</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/jiuto_blog/guide/vue/nextTick.html" class="sidebar-link">vue中$nextTick的实现原理</a></li><li><a href="/jiuto_blog/guide/vue/responsive.html" class="sidebar-link">简单实现vue响应式原理</a></li><li><a href="/jiuto_blog/guide/vue/initData.html" class="sidebar-link">源码分析vue响应式原理</a></li><li><a href="/jiuto_blog/guide/vue/initWatch.html" class="sidebar-link">源码分析vue watch侦听器</a></li><li><a href="/jiuto_blog/guide/vue/patch.html" class="sidebar-link">源码阅读vue VirtualDOM 和 diff</a></li><li><a href="/jiuto_blog/guide/vue/initComputed.html" class="sidebar-link">源码分析vue computed</a></li><li><a href="/jiuto_blog/guide/vue/router.html" class="sidebar-link">源码阅读vue-router</a></li><li><a href="/jiuto_blog/guide/vue/vuex.html" class="sidebar-link">源码阅读vuex</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>webpack</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/jiuto_blog/guide/webpack/webpack_template.html" class="sidebar-link">webpack多页面打包方法工具和模板</a></li><li><a href="/jiuto_blog/guide/webpack/babeltry.html" class="sidebar-link">通过babel手撸超简化版webpack</a></li><li><a href="/jiuto_blog/guide/webpack/plugin_loader.html" class="sidebar-link">手写webpack plugin 和 loader</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>浏览器</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/jiuto_blog/guide/browser/eventloop.html" class="sidebar-link">event loop 事件循环</a></li><li><a href="/jiuto_blog/guide/browser/render.html" class="sidebar-link">浏览器渲染机制</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>网络与安全</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/jiuto_blog/guide/network/http.html" class="sidebar-link">http、https</a></li><li><a href="/jiuto_blog/guide/network/cache.html" class="sidebar-link">浏览器缓存</a></li><li><a href="/jiuto_blog/guide/network/cross.html" class="sidebar-link">跨域</a></li><li><a href="/jiuto_blog/guide/network/security.html" class="sidebar-link">web 安全</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>其他</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/jiuto_blog/guide/else/ele_expend.html" class="sidebar-link">如何在element-ui中拓展一个新的组件</a></li><li><a href="/jiuto_blog/guide/else/cli.html" aria-current="page" class="active sidebar-link">搭建一个脚手架工具</a></li><li><a href="/jiuto_blog/guide/else/utils.html" class="sidebar-link">搭建一个方法库</a></li><li><a href="/jiuto_blog/guide/else/auto_deploy.html" class="sidebar-link">搭建一个自动化部署服务</a></li><li><a href="/jiuto_blog/guide/else/docker_verdaccio.html" class="sidebar-link">在docker中通过Verdaccio搭建一个私有npm库</a></li><li><a href="/jiuto_blog/guide/else/docker_initSql.html" class="sidebar-link">通过Dockerfile在docker中初始化mysql表</a></li><li><a href="/jiuto_blog/guide/else/eslint_prettier.html" class="sidebar-link">在vue/react项目中配置eslint + prettier</a></li><li><a href="/jiuto_blog/guide/else/karma_mocha.html" class="sidebar-link">搭建一个由 karma + mocha + chai + Istanbul 组成的基础测试工具</a></li><li><a href="/jiuto_blog/guide/else/optimization.html" class="sidebar-link">首屏加载优化</a></li><li><a href="/jiuto_blog/guide/else/interview.html" class="sidebar-link">面试路漫漫</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="搭建一个脚手架工具"><a href="#搭建一个脚手架工具" class="header-anchor">#</a> 搭建一个脚手架工具</h2> <blockquote><p>本文讲述如何搭建一个简易的脚手架工具。</p></blockquote> <blockquote><p>简单概括脚手架的原理，即，建好一个模板项目（例如一个已经做好常用配置的vue/react项目），而最简单的脚手架功能就是把这个项目clone下来。</p></blockquote> <blockquote><p>本文示例的项目参见<a href="https://github.com/Jiuto/dc-cli" target="_blank" rel="noopener noreferrer">dc-cli<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，前身为<a href="https://www.npmjs.com/package/crx-cli" target="_blank" rel="noopener noreferrer">crx-cli<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，
示例版本增加了react模板，并不再使用<code>child_process.exec</code>直接执行<code>git clone</code>命令，而是引入了<code>download-git-repo</code>依赖。</p> <p>示例版本因为个人网络原因未能发布，后续将更改包名为<code>@dc/cli</code>发布，
详见组织项目<a href="https://github.com/dc-ken-jiu/dc-cli" target="_blank" rel="noopener noreferrer">dc-cli<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，目前已引入vue-cli以及create-react-app的功能。</p> <p>模板项目参考<a href="https://github.com/dc-ken-jiu/dc-react" target="_blank" rel="noopener noreferrer">dc-react<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<a href="https://github.com/dc-ken-jiu/dc-vue" target="_blank" rel="noopener noreferrer">dc-vue<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <hr> <h3 id="开始搭建"><a href="#开始搭建" class="header-anchor">#</a> 开始搭建</h3> <ol><li>目录结构</li></ol> <img src="/jiuto_blog/imgs/else/cli/file.png" alt="目录结构"> <ol start="2"><li>执行<code>npm init</code>命令生产<code>package.json</code>文件，并下载依赖</li></ol> <img src="/jiuto_blog/imgs/else/cli/package.png" alt="package.json"> <ol start="3"><li>编写执行文件/bin/dc-cli.js</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node
</code></pre></div><p>node执行文件首行需注明<code>#!/usr/bin/env node</code>显式的声明这个文件用node来执行</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">'use strict'</span>
<span class="token keyword">const</span> program <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'commander'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> init <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../command/init'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>引入<a href="https://github.com/tj/commander.js/blob/HEAD/Readme_zh-CN.md" target="_blank" rel="noopener noreferrer">commander<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，引入脚手架主体方法文件</p> <div class="language-js extra-class"><pre class="language-js"><code>program
    <span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../package'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>version<span class="token punctuation">,</span> <span class="token string">'-v, --version'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">usage</span><span class="token punctuation">(</span><span class="token string">'&lt;command&gt; &lt;type&gt; &lt;projectName&gt;'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'init &lt;type&gt; &lt;projectName&gt;'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">'download a new initial project, type could be &quot;vue&quot; or &quot;react&quot;'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">alias</span><span class="token punctuation">(</span><span class="token string">'i'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> projectName</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">init</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> projectName<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

program<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">)</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>program<span class="token punctuation">.</span>args<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
    program<span class="token punctuation">.</span><span class="token function">help</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>if(!program.args.length){ program.help() }</code>如果只是输入&quot;dc-cli&quot;没带参数，就展示能输入的所有命令</p> <p><code>.usage('&lt;command&gt; &lt;type&gt; &lt;projectName&gt;')</code>修改帮助信息的首行提示</p> <p><code>.description('download a new initial project, type could be &quot;vue&quot; or &quot;react&quot;')</code>命令的描述</p> <img src="/jiuto_blog/imgs/else/cli/dc-cli.png" alt="提示信息"> <p><code>.version(require('../package').version, '-v, --version')</code>设置版本号查询命令，</p> <p>当命令参数为<code>-v</code>/<code>-version</code>，响应package.json文件配置的<code>version</code></p> <img src="/jiuto_blog/imgs/else/cli/dc-cli-v.png" alt="版本信息"> <p><code>.command('init &lt;type&gt; &lt;projectName&gt;')</code> 配置命令，命令是init，必要参数为type、projectName</p> <p><code>.alias('i')</code>命令别名</p> <p><code>.action</code>接收一个函数，入参即为命令参数，我们将在这里调用脚手架工具的主体方法</p> <p><code>program.parse(process.argv)</code>必须，解析命令行参数argv</p> <ol start="4"><li>编写脚手架功能/command/init.js</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">'use strict'</span>
<span class="token keyword">const</span> chalk <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'chalk'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ora <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ora'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> download <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'download-git-repo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> vue_projectUrl <span class="token operator">=</span> <span class="token string">'Jiuto/dc-vue'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> react_projectUrl <span class="token operator">=</span> <span class="token string">'Jiuto/dc-react'</span><span class="token punctuation">;</span>
</code></pre></div><p>chalk：终端字符串美化工具</p> <p>ora：loading样式</p> <p>download-git-repo：项目拉取工具</p> <p>声明两个变量，为两种模板项目的git地址，作为download-git-repo的参数</p> <p>拉取项目的逻辑十分简单，直接看代码</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> projectNmae</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 开始计时</span>
    <span class="token keyword">let</span> initStart<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 判断type入参，设置需要拉取的项目url</span>
    <span class="token keyword">let</span> url <span class="token operator">=</span> type <span class="token operator">===</span> <span class="token string">'vue'</span> <span class="token operator">?</span> vue_projectUrl <span class="token operator">:</span> type <span class="token operator">===</span> <span class="token string">'react'</span> <span class="token operator">?</span> react_projectUrl <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token comment">// 当type非法时，给出红色提示</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">redBright</span><span class="token punctuation">(</span><span class="token string">&quot;type must be vue or react&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 提示开始初始化模板</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">whiteBright</span><span class="token punctuation">(</span><span class="token string">'initialization started'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置loading</span>
    <span class="token keyword">let</span> loading <span class="token operator">=</span> <span class="token function">ora</span><span class="token punctuation">(</span><span class="token string">'loading templates...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    loading<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 拉取模板，传入项目地址、项目名称、以及回调函数</span>
    <span class="token function">download</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> projectNmae<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 出现错误，则停止loading，打印错误提示</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            loading<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">redBright</span><span class="token punctuation">(</span><span class="token string">&quot;failed to init&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 拉取成功，则停止loading，打印成功提示和耗时</span>
        <span class="token keyword">else</span><span class="token punctuation">{</span>
            loading<span class="token punctuation">.</span><span class="token function">succeed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">greenBright</span><span class="token punctuation">(</span><span class="token string">&quot;init successed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> initEnd<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">whiteBright</span><span class="token punctuation">(</span><span class="token string">'take '</span><span class="token operator">+</span><span class="token punctuation">(</span>initEnd<span class="token operator">-</span>initStart<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'ms to init'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><br> <img src="/jiuto_blog/imgs/else/cli/loading.png" alt="loading"> <br> <br> <img src="/jiuto_blog/imgs/else/cli/init.png" alt="拉取模板成功"> <ol start="5"><li>增加安装依赖功能</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> exec <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exec<span class="token punctuation">;</span>
<span class="token keyword">const</span> inquirer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'inquirer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> promptList <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">'confirm'</span><span class="token punctuation">,</span>
      message<span class="token operator">:</span> <span class="token string">'Do you want to install npm'</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> <span class="token string">'watch'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>exec：node自带衍生shell执行命令的方法</p> <p>inquirer：命令行交互工具</p> <p>promptList：交互的内容（type：交互提问类型，message：交互文字，name：用户输入的回答变量）</p> <div class="language-js extra-class"><pre class="language-js"><code>inquirer<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span>promptList<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">answers</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>answers<span class="token punctuation">.</span>watch<span class="token punctuation">)</span> <span class="token function">installNPM</span><span class="token punctuation">(</span>projectNmae<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>在项目拉取成功代码下方加入上述代码，当回答的watch变量判断为真，则调用安装npm方法并传入项目名</p> <p>安装npm的逻辑仍然直接看代码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 安装依赖</span>
<span class="token keyword">function</span> <span class="token function">installNPM</span><span class="token punctuation">(</span><span class="token parameter">projectNmae</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 进入项目目录</span>
    process<span class="token punctuation">.</span><span class="token function">chdir</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'/'</span><span class="token operator">+</span>projectNmae<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 开始计时</span>
    <span class="token keyword">let</span> installStart<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 打印安装开始提示</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">whiteBright</span><span class="token punctuation">(</span><span class="token string">'npm installation started'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置loading</span>
    <span class="token keyword">let</span> loading <span class="token operator">=</span> <span class="token function">ora</span><span class="token punctuation">(</span><span class="token string">'npm loading...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    loading<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token comment">// 执行`npm install`命令</span>
    <span class="token function">exec</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">npm install</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 出现错误，则停止loading，打印错误提示</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">{</span>
            loading<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">redBright</span><span class="token punctuation">(</span><span class="token string">&quot;failed to install npm&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 安装完成，则停止loading，打印成功提示和耗时</span>
        <span class="token keyword">else</span><span class="token punctuation">{</span>
            loading<span class="token punctuation">.</span><span class="token function">succeed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">greenBright</span><span class="token punctuation">(</span><span class="token string">&quot;npm install successed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> installEnd<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">whiteBright</span><span class="token punctuation">(</span><span class="token string">'take '</span><span class="token operator">+</span><span class="token punctuation">(</span>installEnd<span class="token operator">-</span>installStart<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'ms to install npm'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 退出shell命令</span>
        process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><br> <img src="/jiuto_blog/imgs/else/cli/npm.png" alt="安装依赖成功"></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/jiuto_blog/guide/else/ele_expend.html" class="prev">
        如何在element-ui中拓展一个新的组件
      </a></span> <span class="next"><a href="/jiuto_blog/guide/else/utils.html">
        搭建一个方法库
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/jiuto_blog/assets/js/app.16126c5f.js" defer></script><script src="/jiuto_blog/assets/js/2.36a0744b.js" defer></script><script src="/jiuto_blog/assets/js/18.d246f955.js" defer></script>
  </body>
</html>
